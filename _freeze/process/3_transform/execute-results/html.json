{
  "hash": "330c915513b637068fddd2ad24dd38e8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Transform\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)    # for data manipulation\nlibrary(stringr)  # for string manipulation\nlibrary(readr)    # for reading in data\nlibrary(tidytext) # for text analysis\nlibrary(ggplot2)  # for data visualization\nlibrary(qtalrkit) # [ ] for data dictionary creation\nlibrary(qtkit)    # for data dictionary creation\nlibrary(knitr)    # for table formatting\n```\n:::\n\n\n## Overview\n\nIn this research, we aim to understand lexical diversity differences between the Spanish varieties. In particular, we want to understand the usage differences between 'aquí' (here) and 'acá' (here) in the Spanish language.\n\nLet's load in the `plain` version of the ACTIVES corpus we curated.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load in the data\nplain_tbl <- read_csv(\"../data/derived/plain_curated.csv\")\n\nglimpse(plain_tbl)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 430\nColumns: 9\n$ doc_id  <chr> \"es_Argentina_1950_Esposa-último-modelo_movie_n_199500\", \"es_A…\n$ text    <chr> \"No está , señora . Aquí tampoco . No aparece , señora . ¿ Dón…\n$ lang    <chr> \"es\", \"es\", \"es\", \"es\", \"es\", \"es\", \"es\", \"es\", \"es\", \"es\", \"e…\n$ country <chr> \"Argentina\", \"Argentina\", \"Argentina\", \"Argentina\", \"Argentina…\n$ year    <dbl> 1950, 1952, 1955, 1965, 1969, 1973, 1975, 1977, 1979, 1980, 19…\n$ title   <chr> \"Esposa-último-modelo\", \"No-abras-nunca-esa-puerta\", \"El-amor-…\n$ type    <chr> \"movie\", \"movie\", \"movie\", \"movie\", \"movie\", \"movie\", \"movie\",…\n$ genre   <chr> \"n\", \"Mystery\", \"Drama\", \"Documentary\", \"Horror\", \"Adventure\",…\n$ imdb_id <dbl> 199500, 184782, 47823, 282622, 62433, 70250, 71897, 333883, 33…\n```\n\n\n:::\n:::\n\n\n## Preparation\n\nThe curated data includes some variables that we can drop as they do not provide any useful information for our analysis. Those that we need to keep include:\n\n- `text`: the text of the transcript\n- `country`: the country of transcript\n\nWe will want a `doc_id`, but the current values of `doc_id` are too verbose and we can simplify them with numeric values.\n\nFurthermore, the `year` variable is not strictly necessary for our analysis, but we will keep it for now. It could become useful as we apply our exploratory analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Drop variables\nplain_tr_tbl <-\n  plain_tbl |>\n    select(doc_id, country, year, text) |>\n    mutate(doc_id = row_number())\n\nglimpse(plain_tr_tbl)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 430\nColumns: 4\n$ doc_id  <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,…\n$ country <chr> \"Argentina\", \"Argentina\", \"Argentina\", \"Argentina\", \"Argentina…\n$ year    <dbl> 1950, 1952, 1955, 1965, 1969, 1973, 1975, 1977, 1979, 1980, 19…\n$ text    <chr> \"No está , señora . Aquí tampoco . No aparece , señora . ¿ Dón…\n```\n\n\n:::\n:::\n\n\nNow, we will want to transform the `text` variable. In one case, we will want to tokenize the text into words. However, if later we want to analyze the the words that cooccur with 'aquí' and 'acá', we can use the `plain_tr_tbl` as is.\n\nLet's create a new variable `token` that will contain the tokenized text. We will also keep the `text` variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Tokenize the text\nplain_tr_tok_tbl <-\n  plain_tr_tbl |>\n  unnest_tokens(token, text)\n\nglimpse(plain_tr_tok_tbl)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 2,642,338\nColumns: 4\n$ doc_id  <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…\n$ country <chr> \"Argentina\", \"Argentina\", \"Argentina\", \"Argentina\", \"Argentina…\n$ year    <dbl> 1950, 1950, 1950, 1950, 1950, 1950, 1950, 1950, 1950, 1950, 19…\n$ token   <chr> \"no\", \"está\", \"señora\", \"aquí\", \"tampoco\", \"no\", \"aparece\", \"s…\n```\n\n\n:::\n:::\n\n\nNow, let's take a look at the relative frequency of 'aquí' and 'acá' in the corpus.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate the relative frequency and proportions\n# of 'aquí' and 'acá' across countries\naqui_aca_country <-\n  plain_tr_tok_tbl |>\n  count(country, token) |>\n  group_by(country) |>\n  mutate(token_relative = n / n()) |>\n  filter(token %in% c(\"aquí\", \"acá\")) |>\n  mutate(token_prop = (token_relative/ sum(token_relative)) * 100)\n\naqui_aca_country |>\n  ggplot(aes(x = country, y = token_prop, fill = token)) +\n  geom_col(position = \"dodge\")\n```\n\n::: {.cell-output-display}\n![Relative frequency and proportions of 'aquí' and 'acá' in the corpus](3_transform_files/figure-html/fig-relative-frequency-prop-1.png){#fig-relative-frequency-prop fig-alt='Relative frequency and proportions of \\'aquí\\' and \\'acá\\' in the corpus' width=672}\n:::\n:::\n\n\n## Write datasets\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Write the dataset\nwrite_csv(plain_tr_tok_tbl, \"../data/derived/plain_tokens_transformed.csv\")\nwrite_csv(plain_tr_tbl, \"../data/derived/plain_transformed.csv\")\n```\n:::\n\n\n## Data dictionary\n\nUse the `create_data_dictionary()` from `qtalrkit` to create a data dictionary for the transformed dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a data dictionary\nqtalrkit::create_data_dictionary(\n  data = plain_tr_tok_tbl,\n  file_path = \"../data/derived/plain_tokens_transformed_dd.csv\",\n  model = \"gpt-3.5-turbo\"\n)\n\nqtalrkit::create_data_dictionary(\n  data = plain_tr_tbl,\n  file_path = \"../data/derived/plain_transformed_dd.csv\",\n  model = \"gpt-3.5-turbo\"\n)\n```\n:::\n\n\nView the data dictionary.\n\n\n::: {#tbl-view-data-dictionary-tokens .cell tbl-cap='Data dictionary for the token transformed dataset'}\n\n```{.r .cell-code}\n# View the data dictionary\nread_csv(\"../data/derived/plain_tokens_transformed_dd.csv\") |>\n  kable()\n```\n\n::: {.cell-output-display}\n\n\n|variable |name        |variable_type |description                             |\n|:--------|:-----------|:-------------|:---------------------------------------|\n|doc_id   |Document ID |numeric       |Unique identifier for each document     |\n|country  |Country     |categorical   |Country where the document was produced |\n|year     |Year        |numeric       |Year when the document was created      |\n|text     |Text        |categorical   |Content of the document                 |\n|token    |Token       |categorical   |Tokenized words from the document       |\n\n\n:::\n:::\n\n::: {#tbl-view-data-dictionary .cell tbl-cap='Data dictionary for the transformed dataset'}\n\n```{.r .cell-code}\n# View the data dictionary\nread_csv(\"../data/derived/plain_transformed_dd.csv\") |>\n  kable()\n```\n\n::: {.cell-output-display}\n\n\n|variable |name        |variable_type |description                                                  |\n|:--------|:-----------|:-------------|:------------------------------------------------------------|\n|doc_id   |Document ID |numeric       |Unique identifier for each document                          |\n|country  |Country     |categorical   |Country where the event described in the document took place |\n|year     |Year        |numeric       |Year when the event described in the document occurred       |\n|text     |Text        |categorical   |Textual description of the event documented                  |\n\n\n:::\n:::\n",
    "supporting": [
      "3_transform_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}